# Template: Multi-output package with C library + Python bindings
{% set name = "REPLACE_NAME" %}
{% set version = "REPLACE_VERSION" %}

package:
  name: {{ name }}-split
  version: {{ version }}

source:
  url: https://github.com/REPLACE_ORG/{{ name }}/archive/refs/tags/v{{ version }}.tar.gz
  sha256: REPLACE_SHA256

build:
  number: 0

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - cmake
    - ninja

outputs:
  # C/C++ library output
  - name: lib{{ name }}
    script: build-lib.sh   # [unix]
    script: bld-lib.bat    # [win]
    build:
      run_exports:
        - {{ pin_subpackage('lib' ~ name, max_pin='x.x') }}
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - {{ stdlib('c') }}
        - cmake
        - ninja
      host:
        - zlib
    test:
      commands:
        - test -f $PREFIX/lib/lib{{ name }}${SHLIB_EXT}    # [unix]
        - if not exist %LIBRARY_BIN%\{{ name }}.dll exit 1  # [win]

  # Python bindings output
  - name: {{ name }}
    script: build-python.sh   # [unix]
    script: bld-python.bat    # [win]
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib('c') }}
        - python                                     # [build_platform != target_platform]
        - cross-python_{{ target_platform }}         # [build_platform != target_platform]
      host:
        - {{ pin_subpackage('lib' ~ name, exact=True) }}
        - python
        - pip
        - cython
      run:
        - {{ pin_subpackage('lib' ~ name, exact=True) }}
        - python
    test:
      imports:
        - {{ name }}
      commands:
        - pip check
      requires:
        - pip

about:
  home: REPLACE_HOMEPAGE
  license: REPLACE_LICENSE
  license_file: LICENSE
  summary: REPLACE_SUMMARY

extra:
  feedstock-name: {{ name }}
  recipe-maintainers:
    - REPLACE_MAINTAINER
